# 阅读热力图 - 需求文档

## 1. 背景
- Android 端《纸间书摘》使用 `HistoryChart` 组件在统计页/在读页展示用户阅读活动热力图（GitHub 风格）。
- iOS 端迁移需 100% 对齐 Android 端的交互行为与视觉表现，使用 SwiftUI 原生方式重新实现。
- Android 参考：`AppConstant.ReadTimeColorLevel`（阈值定义）、`HistoryChart`（周列热力图展示实现）。

## 2. 目标
- 实现 GitHub 风格阅读热力图组件 `HeatmapChart`，100% 对齐 Android 端三项核心交互行为：
  - 星期标签右侧固定（不随横向滚动移动）。
  - 顶部日期标签按“月份切换”显示：同年仅显示月份（如 `2月`），跨年切换显示 `yyyy-M`（如 `2026-1`）。
  - 支持程序化滚动到指定月份（`scrollToMonth` 参数）。
- 提供五级颜色等级映射，阈值与 Android `AppConstant` 完全一致。
- 支持无障碍读屏。

## 3. 范围
- 范围内：
  - `HeatmapChart` 组件本身（布局、滚动、交互、无障碍）。
  - `HeatmapDay` / `HeatmapLevel` 领域模型（数据结构与等级阈值）。
  - 颜色图例条 `HeatmapChart.legend`。
- 范围外：
  - 消费方页面的业务逻辑（统计页、在读页如何组装数据不在本组件范围内）。
  - `StatisticsRepository` 的数据查询实现。
  - 测试页 `HeatmapTestView` 属于调试工具，不纳入功能需求。

## 4. 需求细则

### 4.1 三项 Android 对齐点
- 星期标签固定：星期缩写（一/三/五）固定在网格右侧，横向滚动时不跟随移动，始终可见。
- 顶部日期标签：仅在月份切换列显示标签；同年显示 `M月`，跨年显示 `yyyy-M`；标签使用 `fixedSize()` 防止窄列截断。
- 程序化滚动：外部传入 `scrollToMonth`（格式 `yyyy-M`），组件通过 `ScrollViewReader` 按月份锚点滚动到对应首列。
- 空格子填充：当真实周列数小于可视宽度可容纳列数时，组件必须从左到右绘制真实列，并在右侧补齐空列，禁止整体居中显示。

### 4.2 颜色等级阈值（对齐 Android AppConstant:596-616）

| 等级 | 阅读时长（秒） | 笔记数量 | 打卡时长（秒） |
|------|--------------|---------|--------------|
| none | 0 | 0 | 0 |
| veryLess | 1–1200 | 1–5 | 1–1200 |
| less | 1201–2400 | 6–10 | 1201–2400 |
| more | 2401–3600 | 11–20 | 2401–3600 |
| veryMore | >3600 | >20 | >3600 |

综合等级取阅读时长、笔记数、打卡时长三者最大值。

### 4.3 无障碍读屏
- 每个方格提供 `accessibilityLabel`：日期 + 阅读分钟数 + 打卡次数 + 等级描述。
- 等级文案：无活动 / 少量活动 / 中等活动 / 较多活动 / 大量活动。

## 5. 验收标准
- 星期标签在横向滚动时始终固定在右侧，不随内容移动。
- 顶部日期标签在同一年内仅显示月份；跨年切换列显示 `yyyy-M`，且无截断。
- `scrollToMonth` 传入有效月份字符串后，网格平滑滚动到目标月份。
- 仅有单月或少量周数据时，热力图从左侧开始显示，右侧为空格子补齐，不出现整体居中。
- 五级颜色与 Android 端阈值一一对应，边界值（如 1200/1201）等级跳变正确。
- VoiceOver 开启后，方格可读出日期、阅读时长、打卡次数与等级。
- 今日方格有品牌色描边高亮，未来日期方格透明不可点击。
